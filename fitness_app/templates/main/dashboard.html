{% extends "base.html" %}
{% block title %}Dashboard Â· Fitness App{% endblock %}
{% block content %}
<h2>Today</h2>

{% if today %}
  <div class="card">
    <h3>Today's Workout Plan</h3>
    <ul>
      {% for item in today.items %}
        <li>
          {{ item.name }}
          {% if item.sets %} - {{ item.sets }} sets{% endif %}
          {% if item.reps %} x {{ item.reps }} reps{% endif %}
          {% if item.minutes %} - {{ item.minutes }} min{% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
{% else %}
  <p>No workout plan for today. Create one <a href="{{ url_for('main.planner') }}">here</a>.</p>
{% endif %}

<script>
document.addEventListener('change', (e) => {
  if (e.target.matches('input[type="checkbox"][data-day]')) {
    const form = new FormData();
    form.append('day_id', e.target.dataset.day);
    form.append('item_index', e.target.dataset.index);
    fetch('{{ url_for("main.toggle_item") }}', { method: 'POST', body: form })
      .then(r => r.json()).then(j => {
        if (!j.ok) { alert(j.error || "Failed to save"); e.target.checked = !e.target.checked; }
      }).catch(() => { alert("Network error"); e.target.checked = !e.target.checked; });
  }
});
</script>
{% endblock %}
